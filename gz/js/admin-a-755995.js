/*!
 * we_AdminIndex contains general-purpose helper functions for the admin area
 * we_ViewVersions contains helper functions to help comparing version numbers in the admin area
 *
 * Wedge (http://wedge.org)
 * Copyright © 2010 René-Gilles Deberdt, wedge.org
 * Portions are © 2011 Simple Machines.
 * License: http://wedge.org/license/
 */function we_AdminIndex(c){this.opt=c;if(this.opt.bLoadAnnouncements)this.setAnnouncements();if(this.opt.bLoadVersions)this.showCurrentVersion();if(this.opt.bLoadUpdateNotification)this.checkUpdateAvailable()}we_AdminIndex.prototype.setAnnouncements=function(){var g=this.opt,d='',e=function(c,b,a){if(b=='month')return g.sMonths[a-1];if(b=='shortmonth')return g.sMonthsShort[a-1];if(b=='day')return g.sDays[a];if(b=='shortday')return g.sDaysShort[a]};$.each(window.wedge_news||{},function(){d+=g.sAnnouncementMessageTemplate.wereplace({href:this.href,subject:this.subject,time:this.time.replace(/\$(shortmonth|month|shortday|day)-(\d+)/g,e),message:this.message})});$('#'+g.sAnnouncementContainerId).html(g.sAnnouncementTemplate.wereplace({content:d}))};we_AdminIndex.prototype.showCurrentVersion=function(){if(!('weVersion'in window))return;$('#wedgeVersion').html(window.weVersion);var c=$('#yourVersion'),b=c.html();if(b!=window.weVersion)c.wrap('<span class="alert"></span>')};we_AdminIndex.prototype.checkUpdateAvailable=function(){if(!('weUpdatePackage'in window))return;$('#update_title').html(window.weUpdateTitle||this.opt.sUpdateTitle).css('weUpdateCritical'in window?{color:'#ffcc99',fontSize:'1.2em'}:{});$('#update_message').html(window.weUpdateNotice||this.opt.sUpdateMessage);$('#update_section').show();$('#update-link').attr('href',this.opt.sUpdateLink.wereplace({'package':window.weUpdatePackage}))};function we_ViewVersions(c){this.opt=c;this.oSwaps={};this.determineVersions()}we_ViewVersions.prototype.swapOption=function(c,b){this.oSwaps[b]=!(b in this.oSwaps)||!this.oSwaps[b];$('#'+b).toggle(this.oSwaps[b]);c.blur();return!1};we_ViewVersions.prototype.compareVersions=function(c,b){var a=aParts=[],g=[c,b],d,e;for(d=0;d<2;d++){e=g[d].toLowerCase().replace(/ /g,'');aParts=e.match(/(\d+)(?:\.(\d+|))?(?:\.)?(\d+|)(?:(alpha|beta|rc)(\d+|)(?:\.)?(\d+|))?(?:(dev))?(\d+|)/);if(aParts==null)return!1;a[d]=[aParts[1]>0?parseInt(aParts[1]):0,aParts[2]>0?parseInt(aParts[2]):0,aParts[3]>0?parseInt(aParts[3]):0,typeof aParts[4]=='undefined'?'stable':aParts[4],aParts[5]>0?parseInt(aParts[5]):0,aParts[6]>0?parseInt(aParts[6]):0,typeof aParts[7]!='undefined',]}for(d=0;d<7;d++){if(a[0][d]!=a[1][d]){if(d==3)return a[0][d]<a[1][d]?!a[1][6]:a[0][6];else if(d==6)return a[0][6]?a[1][3]=='stable':!1;else return a[0][d]<a[1][d]}}return!1};we_ViewVersions.prototype.determineVersions=function(){var c={App:'??',Default:'??',Languages:'??',Templates:'??'},b={App:'??',Default:'??',Languages:'??',Templates:'??'},a={App:!1,Default:!1,Languages:!1,Templates:!1},g=['App','Default','Languages','Templates'],d=this,e,k=g.length,f,h,l,i;for(e=0;e<k;e++){$('#'+g[e]).hide();$('#'+g[e]+'-link').data('section',g[e]).click(function(){d.swapOption(this,$(this).data('section'));return!1})}if(!('weVersions'in window))window.weVersions={};for(f in window.weVersions){var j=f.replace(/\./g,'\\.');if(!$('#current'+j).length)continue;h=$('#your'+j).html();for(l in a)if(f.indexOf(l)===0){i=l;break}if(typeof i!='undefined'){if((c[i]=='??'||this.compareVersions(c[i],h))&&!a[i])c[i]=h;if(b[i]=='??'||this.compareVersions(b[i],weVersions[f]))b[i]=weVersions[f];if(this.compareVersions(h,weVersions[f])){a[i]=h;$('#your'+j).css('color','red')}}else if(this.compareVersions(h,weVersions[f]))a[i]=h;$('#current'+j).html(weVersions[f]);$('#your'+j).html(h)}if(!('weLanguageVersions'in window))window.weLanguageVersions={};for(f in window.weLanguageVersions){for(e=0,k=this.opt.aKnownLanguages.length;e<k;e++){if($('#current'+f+this.opt.aKnownLanguages[e]).html(weLanguageVersions[f]).length)continue;h=$('#your'+f+this.opt.aKnownLanguages[e]).html();if((this.compareVersions(c.Languages,h)||c.Languages=='??')&&!a.Languages)c.Languages=h;if(this.compareVersions(b.Languages,weLanguageVersions[f])||b.Languages=='??')b.Languages=weLanguageVersions[f];if(this.compareVersions(h,weLanguageVersions[f])){a.Languages=h;$('#your'+f+this.opt.aKnownLanguages[e]).css('color','red')}}}$('#currentApp').html(b.App);$('#currentDefault').html(b.Default);$('#currentTemplates').html(b.Templates);$('#currentLanguages').html(b.Languages);a.App?$('#yourApp').html(a.App).css('color','red'):$('#yourApp').html(c.App);a.Default?$('#yourDefault').html(a.Default).css('color','red'):$('#yourDefault').html(c.Default);a.Templates?$('#yourTemplates').html(a.Templates).css('color','red'):$('#yourTemplates').html(c.Templates);a.Languages?$('#yourLanguages').html(a.Languages).css('color','red'):$('#yourLanguages').html(c.Languages)};