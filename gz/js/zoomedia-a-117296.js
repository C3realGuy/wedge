/*!
 * Zoomedia is the lightbox component for all media Wedge.
 * Developed by René-Gilles Deberdt (Nao) for Wedge.
 * Uses portions by Steve Smith (http://orderedlist.com/)
 *
 * Wedge (http://wedge.org)
 * Copyright © 2010 René-Gilles Deberdt, wedge.org
 * License: http://wedge.org/license/
 */$.fn.zoomedia=function(m){var x,g,c,v,n,h,M,y,z,j,k,o,a,f,p,q,r,N={closeTitle:'Close'},m=m||{},O=m.outline||'',l=active=!1,s={},i=$(window),P=function(Q){if(l)return!1;l=!0;$('#zoom').remove();$('body').append('			<div id="zoom" class="zoom-'+O+'">				<div id="zoom-content"></div>				<div class="zoom-desc-contain">					<div id="zoom-desc" class="nodrag"></div>				</div>				<a href="#" title="'+(N.closeTitle||'')+'" id="zoom-close">×</a>			</div>');a=$('#zoom');f=$('#zoom-desc');q=$('#zoom-content').dblclick(!1);p=$('#zoom-close').click(A);r=$('.zoom-desc-contain',a);$(document).on('click.zoom',function(b){if(active&&b.target.id!='zoom'&&!$(b.target).closest('#zoom:visible').length)A()}).on('keyup.zoom',function(b){if(active&&b.which==27)A()});n=$(this);h=n.children().first();var F=h.offset();s={x:F.left,y:F.top,w:h.width(),h:h.height()};show_ajax(h);var G=function(){c=$(g=this);var d=m.width||g.width||c.width(),e=m.height||g.height||c.height()||1,t=d/e,w=Math.min(window.innerWidth||i.width(),i.width()),B=Math.min(window.innerHeight||i.height(),i.height()),R=!!C.length;hide_ajax();q.html(c.addClass('scale'));f.html(n.next('.zoom-overlay').html()||'');M=a.width()-d;if(d>w-16){d+=w-16-a.width();e=d/t;c.width(d).height(e)}if(a.height()>B-16){e+=B-16-a.height();d=e*t;c.width(d).height(e)}var H=a.width(),I=a.height();a.offset({left:Math.max(0,i.scrollLeft()+(w-H)/2),top:Math.max(0,i.scrollTop()+(B-I)/2)});if(!R)c.width('100%').height('auto');j={left:s.x+parseInt(h.css('padding-left')),top:s.y+parseInt(h.css('padding-top')),width:s.w,height:s.h,opacity:0};J(H,I);var u=a[0].style,K=function(b){return b.toLowerCase()in u||('Webkit'+b)in u||('Moz'+b)in u||('O'+b)in u||('ms'+b)in u};z=K('Transition')&&K('Transform');a.css(k).css('transform',y).css({opacity:0}).width();a.addClass('anim');var L=a.css('transition-duration')||'.7s',D=parseFloat(L);o=L.indexOf(D+'ms')>-1?D:D*1000;if(z)a.css('transform','').css({opacity:1});else a.stop(!0).css(j).animate(k,o);a.ds();setTimeout(function(){a.addClass('animdone').css('zIndex',800).width();if(x)E(Q);else{a.height('auto');if(f.html()&&!f.is(':visible'))r.slideDown(function(){a.height('auto')});p.fadeIn(300,'linear');q.one('dblclick',E);f.find('.fullsize').click(E)}l=!1;active=!0},o)};var C=n.next('.zoom-html');if(!C.width())$('<img>').on('load.zoom',G).attr('src',n[0].href);else G.call(C.clone().addClass('nodrag').appendTo(q).show()[0]);return!1},E=function(w){x=!1;v=f.find('.fullsize').attr('href');f.find('.fullsize').next().addBack().remove();if(v&&g&&g.src!=v){show_ajax(c);c.off('load.zoom').on('load',function(){var d=g.naturalWidth,e=g.naturalHeight,t=function(){var b=Math.min(i.width()-a.width()+c.width(),d,d*(i.height()-a.height()+c.height())/e);e=e*b/d;hide_ajax();a.animate({left:'-='+(b-c.width()-10)/2,top:'-='+(e-c.height()-10)/2,width:'+='+(b-c.width()-10),height:'+='+(e-c.height()-10)},500,null,function(){a.height('auto');if(f.html()&&!f.is(':visible'))r.slideDown(function(){a.height('auto')});p.fadeIn(300,'linear')})};if(d>0)t();else $('<img>').on('load',function(){d=this.width;e=this.height;$(this).remove();t()}).attr('src',g.src)}).attr('src',v)}else p.fadeIn(300,'linear');return!1},A=function(){if(l||!active)return!1;l=!0;$(a,q).off();$(document).off('.zoom');p.fadeOut(300);r.slideUp(100);setTimeout(function(){J(a.width(),a.height());if(z)a.css('transform','').removeClass('animdone').css('transform',y).css({opacity:0});else a.animate(j,o);setTimeout(function(){l=!1;active=!1;a.remove()},o)},f.html()?100:1);return!1},J=function(b,d){r.hide();k={left:a.offset().left,top:a.offset().top,width:b,height:d,opacity:1};y='translate3d('+(j.left-k.left-(k.width-j.width)/2)+'px,'+(j.top-k.top-(k.height-j.height)/2)+'px,0) scale('+h.width()/c.width()+')'};$(this).each(function(){if(this.className.indexOf('processed')>=0)return this;$(this).addClass('processed').click(P).dblclick(function(b){if(l)x=!0;return!1});$('<div>').addClass('zoom-catcher').appendTo(this).mousedown(!1)});return this};